<!doctype html><html lang="en"><meta charset="UTF-8"><title>DrawAndChatApp_Instruction</title><link href="main.css" rel="stylesheet"><body class="dreamweaverVisualBugTmpFixer galr8 ow4t5"><div class="ksbbr vcr9x" id="id_panelHtseRoot"><div class="giqtt ms0ka"><div class="kalgi nue7p panelTocbotWrapper q961o"><div class="dkvy7 is-position-fixed js-toc q961o toc toc-right zanlr" id="id_tocCurrSession"></div></div></div></div><div class="js-toc-content"><ul id="id_HihesPanel"><li><h3>Introduction</h3><ul><li>DrawAndChatApp is an App that supports::<ul><li><strong>Drawing & Writing Text & Organize Containers</strong> on a <strong>File</strong><li><strong>Communicate</strong> through the Internet on the File<li>(Similar to how multiple people editing on a same OneNote file collaborately over the Internet.<br class="ihiwo ow4t5 spkb0">But with much less Functionalities.)</ul><li><img src="../image/DrawAndChatApp Demo frame85.png" style="max-height:900px;max-width:900px" alt="DrawAndChatApp Demo frame85"></ul><li><h3>Prior Clarification</h3><ul><li>[Development Status] - This is only an <span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05200706_23188"><strong>Experimental</strong></span> project (treat this more like a Demo / simple Script / for Testing purpose only).<li>Following Instructions are mainly based on <code class="ow4t5 qiwzj spkb0" data-timestampnt="05152345_49625">v0.2.35.XXX</code><br class="ihiwo ow4t5 spkb0"></ul><li><h3>Project Environment Requirements</h3><ul><li>Java v17.0.2<li>Kafka v kafka_2.13-3.1.0<li>Mysql v8.0.28</ul><li><h3>How To Use</h3><ul><li><h3>How to Use - plain functionality (in simple words)</h3><ul><li><h3>*Use Procedure</h3><ol><li>vv<ol><li>(Read through the instructions on Github)<li>Download the released zip file from Github & Go to the File location</ol><li>Setup the Config in <strong><code class="ow4t5 qiwzj spkb0" data-timestampnt="05150902_52510">application.yml</code></strong><br class="ihiwo ow4t5 spkb0"><ol><li>vv<ul><li><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161121_35109">Setup <strong>Nothing</strong> -- if you want just the <strong>plain</strong> functionaity</span> eg: draw / text / container ...;<li>Setup the Server for <span id="Kafka__arlsta_311" class="eq27n krcjl ow4t5 spkb0" data-timestampnt="05161303_50311">Kafka</span> -- if you want the plain functionaity + Network message communication by Kafka<li>Setup the Database connection for <span id="Mysql__arlsta_387" class="eq27n krcjl ow4t5 spkb0" data-timestampnt="05161306_21387">Mysql</span> -- if you want the plain functionaity + Save Load file by Mysql</ul><li>Activate the corresponding Spring Profile<br class="ihiwo ow4t5 spkb0">(if you choose setup Nothing, the default will be <span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161252_14634">profile <code class="ow4t5 qiwzj spkb0" data-timestampnt="05161303_01131">plain</code></span><br class="ihiwo ow4t5 spkb0">-- you <strong>dont need</strong> to do this step)</ol><li>Run cmd like following:<br class="ihiwo ow4t5 spkb0"><code class="ow4t5 qiwzj spkb0" data-timestampnt="05150902_52510">java -jar <strong>.\DrawAndChatApp-0.2.35.2-SNAPSHOT.jar</strong> --spring.config.additional-location=.\application.yml</code><li>A Window <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160215_12494">DrawAndChatApp - Session init & control Page</code> will open up<li><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161251_59136">Click the Button <strong><code class="ow4t5 qiwzj spkb0" data-timestampnt="05150911_50589">NewUseSend - Host</code></strong></span><li><strong>Start</strong> Drawing/Editing</ol><li><h3 data-timestampnt="05190848_56376">*Overview (graph)</h3><ul><li><video controls><source src="../image/DrawAndChatApp 20230518_2259_15767 NewUseSend (Plain) .mp4" type="video/mp4"></video></ul></ul><li><h3>How to Use - Network message communication</h3><ul><li><h3>*Use Procedure</h3><ol><li>On both the Host & Guest side, setup the <code class="ow4t5 qiwzj spkb0" data-timestampnt="05152354_05866">application.yml</code><br class="ihiwo ow4t5 spkb0"><ol><li>Provide <span id="Kafka__arlsta_385" class="eq27n krcjl ow4t5 spkb0" data-timestampnt="05161303_57385">Kafka</span> Server ip address,<br class="ihiwo ow4t5 spkb0">eg:: (this eg is: hosting it locally, mainly for testing purpose)<pre class="language-yml">
cpy.rf.ntt.drc:
det-DisableReceiveNetworkMsg-Kafka: false
kafka:
  <span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05190840_03383">bootstrap.servers: "localhost:9092"</span> # @edit_this[base on your Config]</pre><li>Enable the Spring profile<br class="ihiwo ow4t5 spkb0">ie::<br class="ihiwo ow4t5 spkb0"><u><code class="ow4t5 qiwzj spkb0" data-timestampnt="05152356_24370">profiles.active: "plain, <span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161252_15402">Enable_ReceiveNetworkMsg</span>"</code></u></ol></li><script class="eq27n ow4t5 spkb0" data-timestampnt="05161304_53484">document.body.addEventListener("generateLeaderline",function(){"use strict";LeaderlineCreation.addLeaderlineChain(["Kafka__arlsta_311","Kafka__arlsta_385"],LeaderlineStyleUtil.StyleLeaderlineNt.defaultLink)})</script><li>Start up the App in both Host & Guest side<li>vv<ol><li>Click the <span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05190841_23670">Button <strong><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160259_43605">ClearAllMsg_InKafkaTopic</code></strong></span><ul><li>If there are <span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161251_31017">old Kafka Event *<strong>remained</strong>*</span> in the Message Queue (Kafka Topic) (-- didnt get consumed)<br>You will need to <span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05161300_48149"><strong>Clear</strong> those old Msg</span> in Kafka Topic --> otherwise the Receiver will have Old & New Msg mix together<li>(experimental_project_flaw)</ul></ol><li>On Host side - Click the Button <code class="ow4t5 qiwzj spkb0" data-timestampnt="05150911_50589">NewUseSend - Host<br class="ihiwo ow4t5 spkb0"></code><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161252_01402">On Guest side - Click the Button <strong><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160000_42289">ReceiveNetworkMsg - Guest</code></strong></span><li>Start Drawing/Editing in either side -- the File will be synced across the Internet</ol><li><h3 data-timestampnt="05190847_22971">*Overview (graph)</h3><ul><li><video controls><source src="../image/DrawAndChatApp 20230518_2309_00326 ReceiveNetworkMsg .mp4" type="video/mp4"></video></ul></ul><li><h3>How to Use - Save Load file</h3><ul><li><h3>*Prior Clarification</h3><ul><li>The functionality of Save Load file is supported <strong>poorly</strong> at current stage.<br class="ihiwo ow4t5 spkb0"><strong>Do not rely</strong> on this -- you <span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05190921_36079">may or may not experience <strong>datalost</strong></span>.<li>The process requires you to <span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05190926_16466"><b class="kxa7h ow4t5 qiwzj spkb0" data-timestampnt="05190926_12376">clear</b> the database (&/ message queue, if you need)</span>,<br class="ihiwo ow4t5 spkb0">it should only clear the<br class="ihiwo ow4t5 spkb0">specific database (Mysql database <code class="ow4t5 qiwzj spkb0" data-timestampnt="05190924_39263">db_drawandchat_01</code> / <code class="ow4t5 qiwzj spkb0" data-timestampnt="05190924_40352">db_drawandchat_02</code>) &<br class="ihiwo ow4t5 spkb0">specific message queue (Kafka Topic <code class="ow4t5 qiwzj spkb0" data-timestampnt="05190924_38029">Drc_NodeEvent_All-Host</code> & <code class="ow4t5 qiwzj spkb0" data-timestampnt="05190924_35822">Drc_NodeEvent_All-Guest</code>)<br class="ihiwo ow4t5 spkb0">for this App.<li>the code is in::<details><summary>Code</summary><ul><li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05190934_05683">com.redfrog.note.database.DbThreadHelper.clear_TabelRows_db01()</code><ul><li><pre><code>
  public static final String queryStrf_GetAllTableName = "SELECT table_name FROM information_schema.tables   WHERE table_schema = '%s';";
  public static final String queryStrf_RemoveAllRowInATable = "TRUNCATE TABLE %s;";
  public static final String tableName_hibernate_sequence = "hibernate_sequence";

  @Transactional(value = "txm_01")
  public List&lt;String> clear_TabelRows_db01() {
    Query query_GetAllTableName = em_01.createNativeQuery(String.format(queryStrf_GetAllTableName, DbName.db_drawandchat_01));
    List&lt;String> resultList_AllTableName = query_GetAllTableName.getResultList();
    System.out.println(">> clear_TabelRows_db01() :: " + DbOccupation.DbName.db_drawandchat_01 + " :: " + Thread.currentThread().getName() + " :: " + resultList_AllTableName + " :: " + em_01);

    if (resultList_AllTableName.size() > 5) {
      String msg = "Seems deleting a lot of tables es rows? Is this Sql correct? :: numTable=" + resultList_AllTableName.size();
      System.out.println(msg);
      throw new Error(msg);
    }

    for (String tableName : resultList_AllTableName) {
      if (!tableName.equals(tableName_hibernate_sequence)) {
        Query query_RemoveAllRowInATable = em_01.createNativeQuery(String.format(queryStrf_RemoveAllRowInATable, tableName));
        query_RemoveAllRowInATable.executeUpdate();
      }
      else {
        System.out.println("Do nothing with table :: " + tableName_hibernate_sequence);
      }
    }

    return resultList_AllTableName;
  }
</code></pre></ul><li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05190935_47406">com.redfrog.note.util.KafkaUtil.clear_AllMsg_debug(KafkaConfig)</code><ul><li><pre><code>
  public static void clear_AllMsg_debug(KafkaConfig kafkaConfig) {
    String msg = "The way clear_AllMsg() implemented is very bad -- delete Records in a Kafka topic is possible, "
                 + "\n" + "but doesnt have a good API in Java (-- missing sufficient info to get Access to the Partition & the Offset of the Message).";
    System.out.println(msg);
    System.err.println(msg);

    Consumer&lt;String, ? extends Object> kConsumer_AnyRecord = new KafkaConsumer&lt;>(kafkaConfig.kProp_Consumer);
    kConsumer_AnyRecord.subscribe(Arrays.asList(kafkaConfig.kTopicName_Send_NodeEvent_All, kafkaConfig.kTopicName_Receive_NodeEvent_All));
    while (true) {
      try {
      
        ConsumerRecords&lt;String, ? extends Object> consumerRecords = kConsumer_AnyRecord.poll(Duration.ofMillis(1200));
        if (consumerRecords.isEmpty()) {
          System.out.println("Seems all msg drained.");
          kConsumer_AnyRecord.close();
          break;
        }
        for (ConsumerRecord&lt;String, ? extends Object> consumerRecord : consumerRecords) {
          System.out.println("Draining :: " + consumerRecord); //  
        }
      } catch (WakeupException e) {
        System.out.println("Seems we are shutting down :: " + e);
        kConsumer_AnyRecord.close();
      }
    }
  }
</code></pre></ul></ul></details><li>For testing purpose, this is kinda ok (bad still).<br class="ihiwo ow4t5 spkb0">Dont do this in production env.</ul><li><h3>*Internal Design & Concept</h3><ul><li>The *internal* of how save & load works is::<br><pre class="language-bash">mysqldump -u USERNAME -pPASSWORD DBNAME > /path/to/location/backup.sql<br>mysql -u USERNAME -pPASSWORD --database DBNAME &lt; /path/to/location/backup.sql</pre>see https://stackoverflow.com/questions/4283168/how-can-i-backup-a-mysql-database-from-java</ul><li><h3>*Overview (graph)</h3><ul><li><video controls><source src="../image/DrawAndChatApp 20230518_2322_26418 LoadSaveFile .mp4" type="video/mp4"></video><li><img src="../image/DrawAndChatApp 20230519_1047_30182 LoadSaveFile Procedure .png" alt=""></ul><li><h3>*Use Procedure</h3><ol><li>(On the Host side (there is no need for Guest, if you dont needt Network communication),)<br class="ihiwo ow4t5 spkb0">setup the <code class="ow4t5 qiwzj spkb0" data-timestampnt="05152354_05866">application.yml</code><ol><li>Provide Database connection needed info<br class="ihiwo ow4t5 spkb0">Provide Path to <span id="Mysql__arlsta_938" class="eq27n krcjl ow4t5 spkb0" data-timestampnt="05161306_31938">Mysql</span> & ...<br class="ihiwo ow4t5 spkb0">eg::<br class="ihiwo ow4t5 spkb0"><pre class="language-yml">
spring:
  config:
    activate:
      on-profile: "Enable_LoadSaveFile | prod"
  ds-mysql-01:
    driver-class-name: com.mysql.cj.jdbc.Driver
    hibernate.dialect: org.hibernate.dialect.MySQL5Dialect
<span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05190840_18671">    jdbc-url: jdbc:mysql://localhost:3306/db_drawandchat_01 # @edit_this[base on your Config] # database name is hardcoded (seems); (other type of database (not mysql) may not be supported);
    password: mysql # @edit_this[base on your Config]
    username: root # @edit_this[base on your Config]</span>
  ds-mysql-02: # db02 is mainly for debugging 
    driver-class-name: com.mysql.cj.jdbc.Driver
    hibernate.dialect: org.hibernate.dialect.MySQL5Dialect
<u>    jdbc-url: jdbc:mysql://localhost:3306/db_drawandchat_02 # @edit_this[^]
    password: mysql # @edit_this[^] # password & username should be same as db01
    username: root # @edit_this[^]</u>

cpy.rf.ntt.drc:
  det-DisableLoadSaveFile-Mysql: false
  loadSaveFile:
<span class="cglry f31sb indot onf1e ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05190840_27722">    pathStr-drcFileSave: "H:\\DrawAndChatApp_db" # @edit_this[base on your Config] # default path for save & load the file
    pathStr-mysqldump: "C:\\Program Files\\MySQL\\MySQL Server 8.0\\bin\\mysqldump.exe" # @edit_this[base on your Config] # path to mysqldump
    pathStr-mysql: "C:\\Program Files\\MySQL\\MySQL Server 8.0\\bin\\mysql.exe" # @edit_this[base on your Config] # path to mysql # you can just put `mysql` if your env var is properly set (seems)</span>
                      </pre><li>Enable the Spring profile<br class="ihiwo ow4t5 spkb0">ie::<br class="ihiwo ow4t5 spkb0"><u><code class="ow4t5 qiwzj spkb0" data-timestampnt="05152356_24370">profiles.active: "plain, <span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161252_40141">Enable_LoadSaveFile</span>"</code></u></ol></li><script class="eq27n ow4t5 spkb0" data-timestampnt="05161306_38636">document.body.addEventListener("generateLeaderline",function(){"use strict";LeaderlineCreation.addLeaderlineChain(["Mysql__arlsta_387","Mysql__arlsta_938"],LeaderlineStyleUtil.StyleLeaderlineNt.defaultLink)})</script><li>Open the App<li>On Host side - Click the Button <code class="ow4t5 qiwzj spkb0" data-timestampnt="05150911_50589">NewUseSend - Host</code><ul><li>Make sure you are using an *Empty* database for a Session (that you are going to init) (experimental_project_flaw) &lt;see below></ul><li>Start Drawing/Editing<li><strong>Close</strong> the <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160219_49682">Editing File Window</code><li>vv<ul><li>Close confirm?<br class="ihiwo ow4t5 spkb0"><br class="ihiwo ow4t5 spkb0"><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161252_55389"><span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05190839_15747">Sql <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160044_38182">em.persist()</code> is <strong>slow</strong></span></span> & may still be going in the background (just for Saving your file)<br>-- can take <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160044_41692">10s ~ 40s+ ~ ?s</code> to finish all persist.<br>You need to <strong>wait</strong> for that to be finished.<br>Check the Log to see if its done.<li>You can select <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160033_37071">"Auto Close When Sql persist is Done "</code>.<br class="ihiwo ow4t5 spkb0"><ul><li>Please wait for Sql Persist<br class="ihiwo ow4t5 spkb0">In the meantime, dont do more actions.<br>- eg: click inside on the Closing Window.<br>- eg: start another session.<br>- eg: close this window.<br>Just wait only (& watch the log if needed).<br>If persist is still not done after ~3min, will force shutdown & experience datalost<br>If the process is taking too long, you may Force Terminate it, but will experience datalost.<br></ul><li>You can select <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160033_58962">"Force Close Right Now "</code>.<ul><li>(If you dont care about Saving the file)</ul></ul><li>Wait until <strong>Persist</strong> is done.<li>Enter the path you want to save the file to<li><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161253_06529">Click the Button <strong><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160216_20715">SaveFile</code></strong></span> (in <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160215_40558">DrawAndChatApp - Session init & control Page</code>)<li>Wait until Save is done.<li>Close the <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160219_10140">Session init Page</code> (close the App)<li>---<li>Open the App<li>vv<ol><li><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161254_18970"><strong>Select a database</strong></span> you want to use for this Session in <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160229_09417">Force use given db</code><br class="ihiwo ow4t5 spkb0">(On Host side - default is <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160229_41589">db_drawandchat_01</code>)<br class="ihiwo ow4t5 spkb0"><li>(On Host side - pick the database you chose for this session)<br class="ihiwo ow4t5 spkb0">Click the <span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05190841_16345">Button <strong><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160227_48167">ClearAllTableRows_InGivenDb</code></strong></span><ul><li>Make sure you are <span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161255_02907">using an *<strong>Empty</strong>* database</span> for a Session (that you are going to init)<br>  --ie: <span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05161300_34012">*<strong>clear</strong>* the data</span> in the database every time <strong>before</strong> you init a Session.<br>  (for New Session / Receive Session only; Load Session will automatically overwrite the existing database)<br>Otherwise, Existing Old data will be _ cleared / <strong>mixed</strong> with New Data _ for the file in this Session<br>-- the Saved file will be in a <strong>mess</strong> (Unless you dont care about saving the file).<li>If you have existing old data, <span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05161301_06038">following <strong>Warning</strong></span> would be printed::<pre>
  public static final String TextWarn_OverwriteOrAppendDb =
"""
[Warning: 80% - @datalost] det_ExistDataIn_EntityGeneral != 0; for db :: %s
<span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05161301_10609">Detected Existing Old Data</span> in this Db.
"""
+ Text_ClearAllTableRows_InGivenDb +
""" 
Basing on your selection on det_AllowDbOverwriteOrAppend :: %s
If true: 
-> New Data will be Appended to the Existing Old Data - for New session / Receive session. 
-> Existing Old Data will be Cleared, New Data will be Written to an empty/cleared database - for Load session. 
If false: 
-> Throw an Error, Session Abort, No data are cleared or written. 
""";</pre><br class="ihiwo ow4t5 spkb0">Both Host & Guest will need to exist the session, clear the database, clear the msgQueue, restart the session. (experimental_project_flaw)</ul></ol><li>(On Host side -)<br class="ihiwo ow4t5 spkb0">Enter the <b class="kxa7h ow4t5 qiwzj spkb0" data-timestampnt="05161301_53872">path</b> you want to load the file from +<br class="ihiwo ow4t5 spkb0"><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161255_14389">Click the Button <strong><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160216_20715">LoadSaveFile - Host</code></strong></span><li>Wait until Load is done.<li>Start Drawing/Editing (from the saved file)<br class="ihiwo ow4t5 spkb0"></ol></ul><li><h3>How to Use - Network message communication + Save Load file</h3><ul><li><h3>*Use Procedure</h3><ol><li>On <span class="cglry f31sb indot ow4t5 pqmy8 qiwzj r9csy spkb0 t7v89" data-timestampnt="05161256_06433"><strong>both</strong> the Host & Guest side</span>, setup the <code class="ow4t5 qiwzj spkb0" data-timestampnt="05152354_05866">application.yml</code><ol><li>Provide Kafka Server ip address,<br class="ihiwo ow4t5 spkb0">&lt;see above><li>Provide Database connection needed info<br class="ihiwo ow4t5 spkb0">&lt;see above><br class="ihiwo ow4t5 spkb0"><li>Enable the Spring profile<br class="ihiwo ow4t5 spkb0">ie::<br class="ihiwo ow4t5 spkb0"><u><code class="ow4t5 qiwzj spkb0" data-timestampnt="05152356_24370">profiles.active: "<span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161255_20122">Enable_ReceiveNetworkMsg, Enable_LoadSaveFile</span>"</code></u></ol><li>Open the App<li>vv<ul><li><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7tfc t7v89" data-timestampnt="05190841_38892">Before start, clear the database, clear the msgQueue &lt;see above></span></ul><li>On Host side - Click the Button <code class="ow4t5 qiwzj spkb0" data-timestampnt="05150911_50589">NewUseSend - Host</code> /<br class="ihiwo ow4t5 spkb0">On Guest side - Click the Button <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160000_42289">ReceiveNetworkMsg - Guest</code><li>Start Drawing/Editing<li><strong>Close</strong> the <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160219_49682">Editing File Window</code><li>vv<ul><li>&lt;see above></ul><li>Wait until <strong>Persist</strong> is done.<li>Enter the path you want to save the file to<li>Click the Button <strong><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160216_20715">SaveFile</code></strong> (in <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160215_40558">DrawAndChatApp - Session init & control Page</code>)<ul><li>It <span class="cglry f31sb indot ow4t5 pqmy8 qiwzj r9csy spkb0 t7v89" data-timestampnt="05161256_20711">only requires <strong>One Side</strong> Host/Guest to Save the file</span>.<br class="ihiwo ow4t5 spkb0">Whoever <strong>Saved</strong>, <span class="cglry f31sb indot ow4t5 pqmy8 qiwzj r9csy spkb0 t7v89" data-timestampnt="05190842_01283">will be the <strong>Host</strong></span> & Load the saved file, in <span class="cglry f31sb indot ow4t5 pqmy8 qiwzj r9csy spkb0 t7v89" data-timestampnt="05161256_27430">the <strong>Next</strong> Time</span>.<br class="ihiwo ow4t5 spkb0">The other will be the Guest.</ul><li>Wait until Save is done.<li>Close the <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160219_10140">Session init Page</code> (close the App)<li>---<li>Open the App<li>vv<ol><li><strong>Select a database</strong> you want to use for this Session in <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160229_09417">Force use given db</code><br class="ihiwo ow4t5 spkb0">On Host side - default is <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160229_41589">db_drawandchat_01</code><br class="ihiwo ow4t5 spkb0">On Guest side - default is <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160229_41589">db_drawandchat_02</code><ul><li>though, you should <span class="cglry f31sb indot ow4t5 pqmy8 qiwzj r9csy spkb0 t7v89" data-timestampnt="05161256_31556"><strong>prevent</strong> the use of <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160229_41589">db_drawandchat_02</code></span>,<br class="ihiwo ow4t5 spkb0">as its mainly for <span class="cglry f31sb indot ow4t5 pqmy8 qiwzj r9csy spkb0 t7v89" data-timestampnt="05190842_14870"><strong>debugging</strong></span> -- so the same PC can have both Host & Guest running at the same time<br class="ihiwo ow4t5 spkb0">& its un-optimized -- even slower in persist</ul><li>On Host side - pick the database you chose for this session<br class="ihiwo ow4t5 spkb0">On Guest side - pick the database you chose for this session<br class="ihiwo ow4t5 spkb0">Click the Button <strong><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160227_48167">ClearAllTableRows_InGivenDb</code></strong><ul><li>&lt;see above><li>If you have existing old data, following warning would be printed::<br class="ihiwo ow4t5 spkb0">&lt;see above><br class="ihiwo ow4t5 spkb0"><br class="ihiwo ow4t5 spkb0"><span class="cglry f31sb indot ow4t5 pqmy8 qiwzj r9csy spkb0 t7v89" data-timestampnt="05161256_49514">Both Host & Guest will need to exit</span> the session, clear the database, clear the msgQueue, restart the session. (experimental_project_flaw)</ul></ol><li>On Host side -<br class="ihiwo ow4t5 spkb0">Enter the path you want to load the file from +<br class="ihiwo ow4t5 spkb0">Click the Button <strong><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160216_20715">LoadSaveFile - Host</code></strong> /<br class="ihiwo ow4t5 spkb0"><br class="ihiwo ow4t5 spkb0"><span class="cglry f31sb indot ow4t5 pqmy8 qiwzj r9csy spkb0 t7v89" data-timestampnt="05161257_15030">On Guest side -<br class="ihiwo ow4t5 spkb0">Click the Button <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160000_42289">ReceiveNetworkMsg - Guest</code></span><li>Wait until Load is done.<li>Start Drawing/Editing (from the saved file)<br class="ihiwo ow4t5 spkb0"></ol></ul></ul><li><h3>Internal Design & Concept</h3><ul><li><h3>Main Java class</h3><ul><li><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161257_30266"><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160648_52243"><span id="DrawAndChatVm__arlsta_824" class="eq27n krcjl ow4t5 spkb0" data-timestampnt="05161307_52824">DrawAndChatVm</span></code> is the central -- of this Project</span><br class="ihiwo ow4t5 spkb0">-- mainly dealing with the <strong>GUI</strong> functionality & business logic<li><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161257_35417"><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160650_20620">NodeSender_ConvertWrapper</code> & <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160652_30820">NodeSender_EventAnnouncer</code> are the central -- of <strong>DataCommunication</strong></span><br class="ihiwo ow4t5 spkb0">-- for Sending & Persist the Event (& constructing the underlying model (at least attemp to...) (abandont now))<li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160654_23980">NodeSig</code> & <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160654_17073">NodeEvent</code> are the <strong>backbone data structure</strong> -- of all the Node & NodeEvent (all the business objects)<br class="ihiwo ow4t5 spkb0">-- for Serialization across the Network & Persist into the Database (& the underlying model)<li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160700_26226">SessionManager</code> & <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160700_24154">WindowSession</code> is the central -- for the <strong>management</strong> & linkage across all the classes in the Project<br class="ihiwo ow4t5 spkb0">-- for managing & picking among <span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05190902_34190">the 3 Sessions -- <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160702_17133">[NewUseSend, ReceiveNetworkMsg, LoadSaveFile]</code></span><br class="ihiwo ow4t5 spkb0">-- for linking Database & MessageQueue to the Session<li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160700_32100">DrawAndChatAppSessionInit</code> is the first contact when you start the App<br class="ihiwo ow4t5 spkb0">-- for <strong>init</strong> Sessions</ul><li><h3>Code Procedure & Data Flow</h3><ol><li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160700_32100">DrawAndChatAppSessionInit</code><br class="ihiwo ow4t5 spkb0">init session<li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160700_26226">SessionManager</code><br class="ihiwo ow4t5 spkb0">init & create a <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160712_52042">WindowSession</code><br class="ihiwo ow4t5 spkb0">& associate a <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160717_05343">DbOccupation</code> to the Session<br class="ihiwo ow4t5 spkb0">& init <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160716_05097">KafkaConfig</code><li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160648_52243"><span id="DrawAndChatVm__arlsta_553" class="eq27n krcjl ow4t5 spkb0" data-timestampnt="05161307_56553">DrawAndChatVm</span></code><br class="ihiwo ow4t5 spkb0">deal with GUI<br class="ihiwo ow4t5 spkb0">init <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160718_51130">NodeSender_ConvertWrapper</code> & <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160718_44913">NodeReceiver_EventListener</code><ul><li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160724_00949">DrawAndChatVm_ReceiveNetworkMsg</code> & <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160723_58828">DrawAndChatVm_LoadSaveFile</code> are just variations of <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160723_46896">DrawAndChatVm</code><br class="ihiwo ow4t5 spkb0">they both delegate the actual work back to <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160723_46896">DrawAndChatVm</code><br class="ihiwo ow4t5 spkb0"><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160723_46896">DrawAndChatVm</code> -- deal with NewUseSend session (-- actually backbone of all Sessions)<br class="ihiwo ow4t5 spkb0"><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160724_00949">DrawAndChatVm_ReceiveNetworkMsg</code> -- deal with ReceiveNetworkMsg session<br class="ihiwo ow4t5 spkb0"><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160723_58828">DrawAndChatVm_LoadSaveFile</code> -- deal with LoadSaveFile session<li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160718_51130">NodeSender_ConvertWrapper</code> & <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160721_05385">NodeReceiver_ConvertHandler</code> are the bridges between <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160648_52243">DrawAndChatVm</code> & MessageQueue/Database<br class="ihiwo ow4t5 spkb0"><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161257_52704">Data flows like this::<br class="ihiwo ow4t5 spkb0"><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160648_52243"><span id="DrawAndChatVm__arlsta_326" class="eq27n krcjl ow4t5 spkb0" data-timestampnt="05161307_58326">DrawAndChatVm</span></code><br class="ihiwo ow4t5 spkb0">> <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160650_20620">NodeSender_ConvertWrapper</code> > <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160652_30820">NodeSender_EventAnnouncer</code><br class="ihiwo ow4t5 spkb0">> <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160720_25621">NodeReceiver_EventListener</code> > <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160721_05385">NodeReceiver_ConvertHandler</code><br class="ihiwo ow4t5 spkb0">> ...</span><br class="ihiwo ow4t5 spkb0"></li><script class="eq27n ow4t5 spkb0" data-timestampnt="05161308_02526">document.body.addEventListener("generateLeaderline",function(){"use strict";LeaderlineCreation.addLeaderlineChain(["DrawAndChatVm__arlsta_824","DrawAndChatVm__arlsta_553","DrawAndChatVm__arlsta_326"],LeaderlineStyleUtil.StyleLeaderlineNt.defaultLink)})</script></ul><li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160650_20620">NodeSender_ConvertWrapper</code><br class="ihiwo ow4t5 spkb0">wrapper for functions dealing with GUI<br class="ihiwo ow4t5 spkb0">convert <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160730_21901">JavafxNode</code> to <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160710_10703">NodeSig</code> / associate / find them in <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160710_06681">NodeSigManager</code><br class="ihiwo ow4t5 spkb0">construct the underlying model<li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160707_29113">NodeCreatorAndConvertor</code><br class="ihiwo ow4t5 spkb0">actually create & convert <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160730_21105">JavafxNode</code> to/from <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160710_37823">NodeSig</code><li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160652_30820">NodeSender_EventAnnouncer</code><br class="ihiwo ow4t5 spkb0">create the <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160732_19744">NodeEvent</code><br class="ihiwo ow4t5 spkb0"><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161258_09295">send the <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160732_19744">NodeEvent</code></span><br class="ihiwo ow4t5 spkb0">persist to Database<li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160711_53245">DbThreadHelper</code><br class="ihiwo ow4t5 spkb0"><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161258_10422">actually persist to Database</span><br class="ihiwo ow4t5 spkb0">basing on config in <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160716_44210">MultipleDbSpringConfig</code><li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160719_57996">SerializationUtilsSerializer</code> & <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160719_59443">SerializationUtilsDeserializer</code><br class="ihiwo ow4t5 spkb0">deal with Serialization in Kafka<li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160720_25621">NodeReceiver_EventListener</code><br class="ihiwo ow4t5 spkb0"><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161258_20467">receive the <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160732_19744">NodeEvent</code></span><br class="ihiwo ow4t5 spkb0">persist to Datbase<br class="ihiwo ow4t5 spkb0">determine & handle the <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160732_19744">NodeEvent</code><li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05160721_05385">NodeReceiver_ConvertHandler</code><br class="ihiwo ow4t5 spkb0">actually handle the <code class="ow4t5 qiwzj spkb0" data-timestampnt="05160732_19744">NodeEvent</code></ol><li><h3>Mechanism & Design</h3><ul><li><p>This App is built using a mechanism - <strong>Event Sourcing</strong><br class="ihiwo ow4t5 spkb0">-- every single action is sent by MsgBroker & persist into Database -- as an Event.</ul><li><h3>Main Components in GUI</h3><ul><li>Root Panel & Background Canvas<li>Panel (a general Container)<li>TextArea<li>Canvas<li>Linkage Arrow<li>IndexCircle<li>(Resize_Handler)<li>(PaneWrap)</ul><li><h3>*Overview (graph)</h3><ul><li>[Uml of most of the Java Class]<br class="ihiwo ow4t5 spkb0"><img src="plantuml pkg drc note 20230519_133347Z .svg" alt="" id="Uml_of_most_of_the_Java_Class__img_596" style="max-height:1200px;max-width:1200px"><br class="ihiwo ow4t5 spkb0"><li>[Code Flow]<br class="ihiwo ow4t5 spkb0"><img src="DrawAndChatApp_CodeFlow.svg" alt="" id="Code_Flow__img_497" style="max-height:1200px;max-width:1200px"><br class="ihiwo ow4t5 spkb0"></li><script class="eq27n ow4t5 spkb0" data-timestampnt="05191419_02633">document.body.addEventListener("generateLeaderline",function(){"use strict";LeaderlineCreation.addLeaderlineChain(["DrawAndChatVm__arlsta_326","Uml_of_most_of_the_Java_Class__img_596","Code_Flow__img_497"],LeaderlineStyleUtil.StyleLeaderlineNt.defaultLink,[void 0,{x:"38%",y:"18%"},{x:"22%",y:"16%"}])})</script></ul></ul><li><h3>Functionalities & Hotkeys</h3><ul><li><table><tr><th scope="col">Functionality<th scope="col">Hotkey<th scope="col">Description<th scope="col">Activated When<th scope="col">*<tr><th scope="row">Freehand Drawing in Canvas<td>LButton (drag)<td> <td>Focus on Canvas<td> <tr><th scope="row">create a Panel (+ a TextArea)<td>^n<td>(nest supported)<td>Focus on Panel / Root Panel<td> <tr><th scope="row">move a Node<td>^!LButton (drag)<td>(You need to click on the PaneWrap of the Node)<td>Focus on PaneWrap of the Node<td> <tr><th scope="row">remove a Node<td>delete<td>(You need to click on the PaneWrap of the Node)<td>Focus on PaneWrap of the Node<td> <tr><th scope="row">focus on a Node<td>LButton<td>(You need to click on the PaneWrap of the Node)<td>Global<td> <tr><th scope="row">draw an Arrow<br class="ihiwo ow4t5 spkb0">to link 2 Nodes<td>^LButton<br class="ihiwo ow4t5 spkb0"><br class="ihiwo ow4t5 spkb0">RButton (to Cancel)<td>click on Node AA to Start<br class="ihiwo ow4t5 spkb0">&<br class="ihiwo ow4t5 spkb0">click on Node BB to End<br class="ihiwo ow4t5 spkb0"><br class="ihiwo ow4t5 spkb0">(note: its very thin & hard to be clicked to Focus on)<td>Focus on Panel / PaneWrap of the Node<td> <tr><th scope="row">undo<td>^z<td>(undo when focusing in TextArea is diff)<td>Focus on Panel / Root Panel<td> <tr><th scope="row">redo<td>^+z<td> <td>Focus on Panel / Root Panel<td> <tr><th scope="row">clear Drawing in Canvas<td>RButton (drag)<td> <td>Focus on Canvas<td> <tr><th scope="row">create a TextArea<td>^+b<td> <td>Focus on Panel / Root Panel<td> <tr><th scope="row">create a Canvas<td>^m<td> <td>Focus on Panel / Root Panel<td> <tr><th scope="row">type on TextArea (bi-dir)<td>(Tab to focus on)<td> <td>Focus on TextArea<td> <tr><th scope="row">resize a Node<td>^!LButton (drag, on the Resize_Handler)<td> <td>Focus on Resize_Handler of the Node<td> <tr><th scope="row">move Layer of a Node<td>PgUp<br class="ihiwo ow4t5 spkb0">PgDn<br class="ihiwo ow4t5 spkb0">Home<br class="ihiwo ow4t5 spkb0">End<td>(Note:<br class="ihiwo ow4t5 spkb0">the Layer of the Canvas in the Background<br class="ihiwo ow4t5 spkb0">can be moved too)<td>Focus on PaneWrap of the Node<td> <tr><th scope="row">zoom a Node<td>^WheelUp<br class="ihiwo ow4t5 spkb0">^WheelDown<br class="ihiwo ow4t5 spkb0">F1<td>F1 reset the zoom<td>Focus on PaneWrap of the Node<td> <tr><th scope="row">move the Background (Root Panel)<td>^!MButton (drag)<br class="ihiwo ow4t5 spkb0">F4<td>F4 reset the position<td>Global<td> <tr><th scope="row">move the MiniMap<td>^!LButton (drag)<td> <td>Focus on the MiniMap<td> <tr><th scope="row">create a IndexCircle<td>^i<br class="ihiwo ow4t5 spkb0">^1 ^2 ^3 ^4 ^5<td>^i increment index by 1<br class="ihiwo ow4t5 spkb0">^1 reset index to 1<td>Focus on Panel / Root Panel<td> <tr><th scope="row">change Text on IndexCircle<td>(Tab & Type the Text)<td> <td>Focus on the IndexCircle<td> <tr><th scope="row">copy a Node<td> <td>Not supported<td> <td> <tr><th scope="row">cut a Node<td>^x<td> <td>Focus on PaneWrap of the Node<td> <tr><th scope="row">paste a Node<td>^v<td> <td>cut a Node<br class="ihiwo ow4t5 spkb0">&<br class="ihiwo ow4t5 spkb0">Focus on Panel / Root Panel<td> <tr><th scope="row">change Pen Color of Canvas<td>!0<br class="ihiwo ow4t5 spkb0">!1 !2 !3 !4 !5 !6 !7 !8<td>!0 is the original blue color<br class="ihiwo ow4t5 spkb0"><br class="ihiwo ow4t5 spkb0">(Note:<br class="ihiwo ow4t5 spkb0">if the Canvas is not focused (to receive hotkey),<br class="ihiwo ow4t5 spkb0">you can Tab to focus on it)<td>Focus on Canvas<td> <tr><th scope="row"> <td> <td> <td> <td> </table><li>* annotate<ul><li>Ahk Hotkey style Notation<ul><li>^ = Ctrl<li>! = Alt<li>+ = Shift<li>LButton = Left Mouse Click</ul><li>The order of the Table looks messy,<br class="ihiwo ow4t5 spkb0">cuz its kinda base on the Time the functionalities are added (implemented) to the App.</ul></ul><li><h3>Development Status</h3><ul><li><span class="cglry f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89 tygok" data-timestampnt="05161259_08039">This is only an <strong><span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05200706_14109">Experimental</span></strong> project</span> (treat this more like a Demo / simple Script / for Testing purpose only).<br class="ihiwo ow4t5 spkb0">Do Not expect the code runs good enough in a real production environment -- it may be buggy.<li>Do not use this a Library, its API is not defined. -- its intended to be only used as a GUI application.<li>The code is still under drafting & very messy.<br class="ihiwo ow4t5 spkb0">You can see a lot of Bad coding pratice.<br class="ihiwo ow4t5 spkb0">eg::<br class="ihiwo ow4t5 spkb0"><ul><li>abusing the use of <code class="ow4t5 qiwzj spkb0" data-timestampnt="05150936_02902">static</code><li>a lot of things are <code class="ow4t5 qiwzj spkb0" data-timestampnt="05150936_23571">public</code><li>field reference comes from nowhere<li>the way some method implemented is fragile, error prone, just a workaround<li>omit some config that is required to make the App less buggy<li>...</ul><li>Do not try to understand / modify the code, as they are badly written.<li>The code is Slow<li>The code doesnt fully Utilize the power of Spring DI & mix with other instance management designs</ul><li><h3>Technology Stack</h3><ul><li>JavaFx<li>Kafka<li>Mysql + Hibernate<li>Spring</ul><li><h3>Design Difficulties & Problems facing</h3><ul><li>Underlying Model<ul><li>In the original design of this Project,<br class="ihiwo ow4t5 spkb0">there was an intention to build a <strong>underlying model</strong> that models everything (eg: Gui components ...).<br class="ihiwo ow4t5 spkb0">But as the Project grows, this becomes harder to implement & takes too much time. And was <strong>abandoned</strong>.</ul><li>Undo Manager<ul><li>Implementing <strong>Undo</strong>/Redo is usually not easy. (Similar to implement Transaction rollback.)<br class="ihiwo ow4t5 spkb0">But turns out, it wasnt that difficult in this Project (at least, at current stage) (when underlying model is out of concern).</ul><li>Session Management<ul><li>Session management was not easy. At least, the structure of coding did not appear to be clear, (cuz this was not planed origianlly).<br class="ihiwo ow4t5 spkb0">The whole project was kinda rebuilt due to this.<br class="ihiwo ow4t5 spkb0">And the <strong>management</strong> of many Spring Beans was messed up, many of them were removed during the rebuilt.<br class="ihiwo ow4t5 spkb0">Considering to use <code class="ow4t5 qiwzj spkb0" data-timestampnt="05171621_09384">@Scope("prototype")</code> (but not sure how well it will do).</ul><li>Multiple Database Configuration<ul><li>If I fall back to only use Hibernate, maybe the Config would be more clear.<br class="ihiwo ow4t5 spkb0">But since Spring Boot is used, I tried to config things in Spring boot.<br class="ihiwo ow4t5 spkb0">However, having <b class="kxa7h ow4t5 qiwzj spkb0" data-timestampnt="05171736_06135">multiple Databases</b> (& multiple Transaction Managers) in Spring boot Config doesnt seem like a common task?<br class="ihiwo ow4t5 spkb0">The <span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05190906_22761">configuration is actually a little <strong>messy</strong></span> in the code.<br class="ihiwo ow4t5 spkb0">And this dramtically affected how I use the Transaction Manager & Database Persist (resulted in a very <strong>bad</strong> way of coding).</ul><li>Speed of Persist to Database (& Size of the Saved File)<ul><li><span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05190906_30565">Persist to Database is very <strong>Slow</strong></span>. This is currently the Key & Serious Problem I am facing.<br class="ihiwo ow4t5 spkb0">Following are the reasons due to & attempts to resolve::<li>Event Sourcing<ul><li>Event Sourcing is used -- there are a lot of things to persist<br class="ihiwo ow4t5 spkb0">-- every single action triggers 1~10+ Events to persist & 1~2+ Objects (mostly Nodes, in this project) to persist.<li>Event Sourcing is used -- every single event will have to be a complete new <strong>snapshot</strong> & unmodifiable.<br class="ihiwo ow4t5 spkb0"><ul><li>Plus, an Event can be <strong>associated</strong> to an Object & many Events can come from the same Object & the internal field of the Object can be changed at any time.<br class="ihiwo ow4t5 spkb0">This means, not only: I need to persist a New Event every time.<br class="ihiwo ow4t5 spkb0">but also: I have to create a New Copy of the Object every time to persist with the Event.<br class="ihiwo ow4t5 spkb0"><ul><li>You cannot use Update to change the existing Object in the database (instead of persisting a New Object).<br class="ihiwo ow4t5 spkb0">Because that means you are changing the Past History & breaks the whole point of Event Sourcing.</ul><li>Optimizing this will be complex.</ul></ul><li>Data Structure & Blob<ul><li>I didnt spent too much time on optimizing the data structure to Persist into the Database.<br class="ihiwo ow4t5 spkb0">Sometimes I just persist a whole <strong>Blob</strong> to save my time of coding.<ul><li>Pros<ul><li>Increase the speed of persist & access.<li>Less concern about the data structure & what to persist.<li>Fits well with Event sourcing, as its kinda immutable & no concern of Id / Transient / Cascade things...</ul><li>Cons<ul><li><span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05190907_42950">Large <strong>file size</strong></span><li>Bad data structure</ul></ul></ul><li>Data Structure & Inheritance<ul><li>The strategy was originally chosen to be<br class="ihiwo ow4t5 spkb0"><code class="ow4t5 qiwzj spkb0" data-timestampnt="05171646_33508">@Inheritance(strategy = InheritanceType.JOINED)</code><li>But it was changed to<br class="ihiwo ow4t5 spkb0"><code class="ow4t5 qiwzj spkb0" data-timestampnt="05171647_25198">@Inheritance(strategy = InheritanceType.<strong>SINGLE_TABLE</strong>)</code><br class="ihiwo ow4t5 spkb0">at later stage.<br class="ihiwo ow4t5 spkb0">As this Greatly Increases the <strong>Speed</strong> of Database Query.</ul><li>Batch Persist & Mysql<ul><li>Manual <strong>Batching</strong> was implemented to speed up the Persist.<li>Hibernate Batching was also enabled.<br class="ihiwo ow4t5 spkb0">However, it wont work.<br class="ihiwo ow4t5 spkb0">Because the Database Im using is Mysql<br class="ihiwo ow4t5 spkb0">& it doesnt support <code class="ow4t5 qiwzj spkb0" data-timestampnt="05171650_50539">@GeneratedValue(strategy = GenerationType.<strong>SEQUENCE</strong>)</code><li>I tried to <strong>manually assign the Id</strong> to all the Entities (of course this is bad).<br class="ihiwo ow4t5 spkb0">It appears to work, but didnt.<br class="ihiwo ow4t5 spkb0"><ul><li>In earlier versions, <span class="cglry f31sb gzv9k indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05190908_16639">the Speed Tested was ~12s to persist 6 panel</span> (+ all the events behind it).<br class="ihiwo ow4t5 spkb0">& this didnt change whether I use Batch or not.</ul><li>Another way would be use JDBC to batch the Events,<br class="ihiwo ow4t5 spkb0">but that means losing the powser of JPA<br class="ihiwo ow4t5 spkb0">& requires a much more time on coding that.</ul><li>Reduction of Unnecessary Persist<ul><li>eg: Drag on an Object usually product a lot of Events for every Pixel it moves.<br class="ihiwo ow4t5 spkb0">The App reduced to only persist the <b class="kxa7h ow4t5 qiwzj spkb0" data-timestampnt="05190912_33686">Key</b> events into the Database.<br class="ihiwo ow4t5 spkb0">While the App is chosen to still send <b class="kxa7h ow4t5 qiwzj spkb0" data-timestampnt="05190912_34869">All</b> the events through the Network -- to provide a better synchronization on the editing of the file (its a trade off).</ul><li>Caching<ul><li>Caching is not really related in this case (/ in this Project (at current stage)). And there is no Config on it.</ul></ul><li>Set Id to Null & detached & cascade & snapshot of the Event<ul><li>As said, >"many Events can come from the <strong>same Object</strong> & the internal field of the Object can be changed at any time"<li>When <strong>Cascade</strong> is used <code class="ow4t5 qiwzj spkb0" data-timestampnt="05171658_48668">@OneToOne(cascade = { CascadeType.PERSIST })</code>,<br class="ihiwo ow4t5 spkb0">often times you can see the error of persisting a <strong>Detached</strong> Entity.<li>The problem is not its detached,<br class="ihiwo ow4t5 spkb0">the problem is<br class="ihiwo ow4t5 spkb0">Cascade Persist should persist a <strong>snapshot</strong> of the Object, (as the Object's field value would have changed in the meantime of 2 events).<br class="ihiwo ow4t5 spkb0">instead of trying to detect this object already exist in database & throw an Error about this Object is detached.<li>A bad way to workaround with this, is to <strong>set the Id of this Object back to null</strong>.<br class="ihiwo ow4t5 spkb0">But this really breaks the management of Entites in Hibernate.</ul><li>Serialization & Kafka Topic & Event Type<ul><li>Normally there should be different Serializer for diff Event type (I think)<li>But, <strong>a generic Serializer</strong> was used in this Project for nearly All Event types.<li>All the Events implements the <code class="ow4t5 qiwzj spkb0" data-timestampnt="05171705_46070">Serializable</code> Interface.<li><code class="ow4t5 qiwzj spkb0" data-timestampnt="05171706_18422">Protobuf</code> will be considered.</ul><li>Message Order & Kafka Topic & Idempotent & Kafka Config<ul><li>To ensure <span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05190915_28789">the <strong>Order</strong> of the Event</span>.<br class="ihiwo ow4t5 spkb0">All the Events are Sent to the <strong>same Topic & same Partition</strong> with the same Key.<ul><li>(But I dont think this is how categorization of Kafka Topic is used...)</ul><li>To ensure the Message arrive Exactly Once,<br class="ihiwo ow4t5 spkb0"><strong>Idempotent</strong> could be used in Kafka.<br class="ihiwo ow4t5 spkb0">But this will decrease the speed.<br class="ihiwo ow4t5 spkb0">And I didnt config this.<li><strong>Other Configs</strong> to ensure the Availablity of Kafka Brokers / handle Network failure / scaling were not configured.</ul><li>Database Transaction & Rollback & Multi Threading Concurrency<ul><li>(This is actually a Huge problem for this Project.)<li><span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05190916_33465"><strong>Database transaction</strong></span> was left to Spring.<br class="ihiwo ow4t5 spkb0">(Tbh, I would rather to do it manually, so I have more control on this. Im not sure how Spring really handles this.)<br class="ihiwo ow4t5 spkb0">But there is no Error Handling / Rollback.<li>Kafka Error handling was not implemented.<li>Transaction span across multiple Database & Message Broker is not implemented (the situation refers to Microservices here).<li>Multi threading may <strong>not</strong> be implemented <strong>safely</strong> in this Project.</ul><li>Multi Threading & <span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05190916_52667">Concurrent Editing</span> & Transaction Atomicity<ul><li>There could be situation where:<br class="ihiwo ow4t5 spkb0">one User UU is editing on an Object AA, another User VV is <strong>also editing</strong> on AA.<br class="ihiwo ow4t5 spkb0">And there is <strong>Lag</strong> across the Network.<br class="ihiwo ow4t5 spkb0">AA is under race condition.<br class="ihiwo ow4t5 spkb0"><li>The <strong>Atomicity</strong> will depend on (the Local Javafx Thread &) How <strong>Transaction</strong> is implemented across the Network.<br class="ihiwo ow4t5 spkb0">And Transaction <strong>Rollback</strong> must be implemented when this happens.<br class="ihiwo ow4t5 spkb0">A Qualification system of which User's Editing is valid is also needed.<br class="ihiwo ow4t5 spkb0">A system to contact (access / passing info) among different Processes is also needed.<br class="ihiwo ow4t5 spkb0">(involving Network, Message Broker, Database, Gui Thread, the design of transaction of business logic in this Application itself, ...)<li>This is not implemented (at current stage) as this is very complex.<br class="ihiwo ow4t5 spkb0">(Again transaction is a big topic.)</ul></ul><li><h3>Q&A</h3><ul><li>Unable to Get Started to Run this Project?<ul><li>As said in Section [How to Use - plain functionality (in simple words)]<br class="ihiwo ow4t5 spkb0">If you just want the plain functionality (the profile <code class="ow4t5 qiwzj spkb0" data-timestampnt="05171750_31758">plain</code> is designed specifically for this case).<br class="ihiwo ow4t5 spkb0">There is no setting you need to config (the default provided <code class="ow4t5 qiwzj spkb0" data-timestampnt="05171748_37715">application.yml</code> is ready to use).<br class="ihiwo ow4t5 spkb0"><br class="ihiwo ow4t5 spkb0">All you need to do is just to run the jar, like the following:<br class="ihiwo ow4t5 spkb0"><code class="ow4t5 qiwzj spkb0" data-timestampnt="05171747_23071">java -jar .\DrawAndChatApp-0.2.35.2-SNAPSHOT.jar --spring.config.additional-location=.\application.yml</code><br class="ihiwo ow4t5 spkb0"><br class="ihiwo ow4t5 spkb0">If this doesnt work, Idk how.<br class="ihiwo ow4t5 spkb0"></ul><li>Github Issue (asking question & bug report & feature request)?<ul><li>As this Project is only Experimental & under drafting. There are sure lots of bugs & may not worth to be mentioned.<br class="ihiwo ow4t5 spkb0">Post on Issue may not be supported.<li>Also, as said, this Project's code is under drafting & messy & not indented to be welly understood.<br class="ihiwo ow4t5 spkb0">Attempts to read & suggest to fix the code are probably not worth it.</ul><li>Change Gui Style?<ul><li>Only very limited styles for the Gui Components are supported at current stage.<br class="ihiwo ow4t5 spkb0">More styles may not be added currently.</ul><li>Why not FXML?<ul><li>May use, when the project is more complex & when I have more time to deal with Javafx.</ul><li>Why not Javascript?<ul><li>Javascript may be very helpful. But currently just want to do & try things in mostly Java.</ul><li>Reinventing the Wheels?<ul><li>There are probably some codes can be replaced by using some other library functions that works better.<br class="ihiwo ow4t5 spkb0">They will be replaced if needed. Or, they are still under evoling / serve for different purposes.</ul><li>Where is the Test Case?<ul><li>Didnt plan to build many test cases early originally.<li>Later finds that testing a Gui App is not easy... So there are no Test cases currently.</ul><li>Where is the Comment & JavaDoc?<ul><li>The comments I had in the Code are hideously long & unreadable. So they are all removed.<ul><li>(Hopefully this doesnt break the code, it shouldnt but <span class="cglry dq5js f31sb indot ow4t5 qiwzj r9csy spkb0 t7v89" data-timestampnt="05191156_07451">might remove some actual code</span> accidentally during the process.)</ul><li>JavaDoc are not written, as this is only a Project under drafting & Not intended to be used as a library.</ul><li>Consider Microservices / Docker?<ul><li>Not now.</ul><li></ul></ul></div><script>let i=1;console.log(i)</script><script defer src="main.js"></script>